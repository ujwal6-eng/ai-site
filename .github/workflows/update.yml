name: Update AI Website

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: Generate AI content using OpenRouter
        run: |
          cat << 'EOF' > payload.json
          {
            "model": "meta-llama/Llama-3-8b-chat",
            "messages": [
              {
                "role": "user",
                "content": "Write a fun, short AI fact for my daily website."
              }
            ]
          }
          EOF

          response=$(curl -s -X POST "https://openrouter.ai/api/v1/chat/completions" \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.OPENROUTER_KEY }}" \
          -d @payload.json)

          echo "Raw API response:"
          echo "$response"

          content=$(echo "$response" | jq -r '.choices[0].message.content')

          echo "<html><body><h1>Daily AI Fact</h1><p>$content</p></body></html>" > index.html

      - name: Commit and Push
        run: |
          git config user.name "ujwal6-eng"
          git config user.email "youremail@example.com"
          git add index.html
          git commit -m "Daily AI update"
          git push
