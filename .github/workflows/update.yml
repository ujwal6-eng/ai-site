name: Update AI Website

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: Generate AI content using OpenRouter
        run: |
          # JSON payload
          cat << 'EOF' > payload.json
          {
            "model": "meta-llama/llama-3.1-8b-instruct",
            "messages": [
              {
                "role": "user",
                "content": "Give one short interesting AI fact for a website."
              }
            ]
          }
          EOF

          # API Request
          response=$(curl -s -X POST "https://openrouter.ai/api/v1/chat/completions" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.OPENROUTER_KEY }}" \
            -d @payload.json)

          echo "Raw Response: $response"

          # Extract content safely
          content=$(echo "$response" | jq -r '.choices[0].message.content // empty')

          if [ -z "$content" ]; then
            content="AI could not generate content today. (Check model / API key)"
          fi

          echo "<html><body><h1>Daily AI Fact</h1><p>$content</p></body></html>" > index.html

      - name: Commit and Push
        run: |
          git config user.name "ujwal6-eng"
          git config user.email "youremail@example.com"
          git add index.html
          git commit -m "Daily AI update" || echo "No changes"
          git push
